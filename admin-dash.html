<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard - Grace Fellowship Church</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body { background: #f8f9fa; }
  .container { max-width: 1000px; margin-top: 40px; }
  .card { margin-bottom: 20px; }
</style>
</head>
<body>

<header class="bg-primary text-white py-3 mb-3">
  <div class="container d-flex justify-content-between align-items-center">
    <h3 class="m-0">Admin Dashboard</h3>
    <nav>
      <a href="index.html" class="btn btn-light btn-sm mx-1">Home</a>
      <a href="registration.html" class="btn btn-light btn-sm mx-1">Register</a>
      <a href="admin-dash.html" class="btn btn-light btn-sm mx-1">Admin</a>
      <a href="session.html" class="btn btn-light btn-sm mx-1">Attendance</a>
    </nav>
  </div>
</header>

<div class="container">
  <h2 class="text-center mb-4">üìã Admin Dashboard</h2>

  <!-- Registration Control -->
  <div class="card">
    <div class="card-body">
      <h5 class="card-title">Registration Control</h5>
      <p>Status: <span id="regStatus" class="badge bg-success">Open</span></p>
      <button id="toggleRegBtn" class="btn btn-warning">Close Registration</button>
    </div>
  </div>

  <!-- Session Control -->
  <div class="card">
    <div class="card-body">
      <h5 class="card-title">Attendance Session</h5>
      <div class="mb-3">
        <label>Date</label>
        <input type="date" id="sessionDate" class="form-control">
      </div>
      <div class="mb-3">
        <label>Time</label>
        <input type="time" id="sessionTime" class="form-control">
      </div>
      <button id="startSessionBtn" class="btn btn-primary w-100">Start Session</button>
      <button id="closeSessionBtn" class="btn btn-danger w-100 mt-2">Close Session</button>
      <div id="sessionMsg" class="mt-2"></div>
    </div>
  </div>

  <!-- Member Management -->
  <div class="card">
    <div class="card-body">
      <h5 class="card-title">Members List</h5>
      <ul id="memberList" class="list-group mb-3"></ul>
      <div class="mb-3">
        <input type="text" id="memberName" placeholder="Full Name" class="form-control mb-2">
        <input type="text" id="memberRole" placeholder="Role (optional)" class="form-control mb-2">
        <input type="text" id="memberPhone" placeholder="Phone" class="form-control mb-2">
        <button id="addMemberBtn" class="btn btn-success w-100">Add Member</button>
        <div id="addMsg" class="mt-2"></div>
      </div>
    </div>
  </div>

</div>

<script>
let members = JSON.parse(localStorage.getItem("members")) || [];
let regOpen = JSON.parse(localStorage.getItem("regOpen")) ?? true;

// --- Elements ---
const regStatus = document.getElementById("regStatus");
const toggleRegBtn = document.getElementById("toggleRegBtn");
const memberList = document.getElementById("memberList");
const addMsg = document.getElementById("addMsg");

const sessionDateInput = document.getElementById("sessionDate");
const sessionTimeInput = document.getElementById("sessionTime");
const startSessionBtn = document.getElementById("startSessionBtn");
const closeSessionBtn = document.getElementById("closeSessionBtn");
const sessionMsg = document.getElementById("sessionMsg");

// --- Render Members ---
function renderMembers() {
  memberList.innerHTML = "";
  if (!members.length) {
    memberList.innerHTML = `<li class="list-group-item">No members yet.</li>`;
    return;
  }
  members.forEach((m, index) => {
    const li = document.createElement("li");
    li.className = "list-group-item d-flex justify-content-between align-items-center";
    li.innerHTML = `${m.fullName} (${m.role || "Member"}) - ${m.phone} 
      <button class="btn btn-sm btn-danger">Delete</button>`;
    li.querySelector("button").onclick = () => {
      if(confirm(`Delete ${m.fullName}?`)) {
        members.splice(index, 1);
        localStorage.setItem("members", JSON.stringify(members));
        renderMembers();
      }
    };
    memberList.appendChild(li);
  });
}

// --- Render Registration Status ---
function renderRegStatus() {
  regStatus.innerHTML = `Status: <span class="badge ${regOpen ? "bg-success" : "bg-danger"}">
    ${regOpen ? "Open" : "Closed"}</span>`;
  toggleRegBtn.textContent = regOpen ? "Close Registration" : "Open Registration";
}

// --- Toggle Registration ---
toggleRegBtn.onclick = () => {
  regOpen = !regOpen;
  localStorage.setItem("regOpen", JSON.stringify(regOpen));
  renderRegStatus();
};

// --- Add Member ---
document.getElementById("addMemberBtn").onclick = () => {
  if (!regOpen) return alert("Registration is closed.");
  const name = document.getElementById("memberName").value.trim();
  const role = document.getElementById("memberRole").value.trim();
  const phone = document.getElementById("memberPhone").value.trim();
  if (!name || !phone) return alert("Name and phone are required.");
  if (!/^\d+$/.test(phone)) return alert("Phone must contain digits only.");
  if (members.some(m => m.phone === phone)) {
    addMsg.innerHTML = `<div class="alert alert-danger">‚ö†Ô∏è Phone number already exists.</div>`;
    setTimeout(() => addMsg.innerHTML="", 4000);
    return;
  }

  members.push({ id: Date.now().toString(), fullName: name, role, phone });
  localStorage.setItem("members", JSON.stringify(members));
  document.getElementById("memberName").value = "";
  document.getElementById("memberRole").value = "";
  document.getElementById("memberPhone").value = "";
  addMsg.innerHTML = `<div class="alert alert-success">‚úÖ Member added successfully.</div>`;
  setTimeout(() => addMsg.innerHTML="", 4000);
  renderMembers();
};

// --- Session Control ---
startSessionBtn.onclick = () => {
  const date = sessionDateInput.value;
  const time = sessionTimeInput.value;
  if(!date || !time) return alert("Set both date and time");

  const currentSession = {
    sessionOpen: true,
    sessionDate: date,
    sessionTime: time,
    attendanceRecords: []
  };
  localStorage.setItem("currentSession", JSON.stringify(currentSession));
  localStorage.setItem("sessionOpen", JSON.stringify(true));
  localStorage.setItem("sessionDate", date);
  localStorage.setItem("sessionTime", time);

  sessionMsg.innerHTML = "<div class='text-success'>‚úÖ Session started!</div>";
};

closeSessionBtn.onclick = () => {
  let currentSession = JSON.parse(localStorage.getItem("currentSession")) || {};
  currentSession.sessionOpen = false;
  localStorage.setItem("currentSession", JSON.stringify(currentSession));
  localStorage.setItem("sessionOpen", JSON.stringify(false));
  sessionMsg.innerHTML = "<div class='text-warning'>‚ö†Ô∏è Session closed.</div>";
};

// --- Initialize ---
renderMembers();
renderRegStatus();
</script>

</body>
</html>
