<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard - Top Ministries International</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body { display: flex; flex-direction: column; min-height: 100vh; margin: 0; background: #f8f9fa; }

  /* Header fixed and shrinkable */
  header { 
    background-color:#f71717; 
    color: white; 
    padding: 1rem; 
    position: fixed; 
    top: 0; 
    width: 100%; 
    z-index: 1000; 
    display: flex; 
    justify-content: space-between; 
    flex-wrap: wrap; 
    align-items: center; 
    transition: all 0.3s ease; 
  }
  header.shrink { padding: 0.5rem 1rem; }
  header h3 { margin: 0; font-size: 1.5rem; transition: all 0.3s ease; }
  header.shrink h3 { font-size: 1.2rem; }
  nav a { margin: 0 0.5rem; }

  main { flex: 1 0 auto; padding: 120px 15px 20px; max-width: 1000px; margin: auto; }

  .card { margin-bottom: 20px; }

  footer { flex-shrink: 0; background-color: #343a40; color: white; padding: 1rem; text-align: center; }

  /* Back to Top button */
  #backToTop {
    position: fixed;
    bottom: 40px;
    right: 20px;
    display: none;
    z-index: 999;
    border-radius: 50%;
    width: 45px;
    height: 45px;
    font-size: 24px;
    line-height: 1;
    padding: 0;
  }

  @media(max-width: 576px){
    nav { width: 100%; text-align: center; margin-top: 0.5rem; }
    nav a { display: inline-block; margin: 0.25rem 0.25rem; }
  }
</style>
</head>
<body>

<header>
  <h3>Admin Dashboard</h3>
  <nav>
    <a href="index.html" class="btn btn-light btn-sm">Home</a>
    <a href="registration.html" class="btn btn-light btn-sm">Register</a>
    <a href="admin-dash.html" class="btn btn-light btn-sm">Admin</a>
    <a href="session.html" class="btn btn-light btn-sm">Attendance</a>
  </nav>
</header>

<main>
  <h2 class="text-center mb-4">üìã Admin Dashboard</h2>

  <!-- Registration Control -->
  <div class="card">
    <div class="card-body">
      <h5 class="card-title">Registration Control</h5>
      <p>Status: <span id="regStatus" class="badge bg-success">Open</span></p>
      <button id="toggleRegBtn" class="btn btn-warning">Close Registration</button>
    </div>
  </div>

  <!-- Session Control -->
  <div class="card">
    <div class="card-body">
      <h5 class="card-title">Attendance Session</h5>
      <div class="mb-3">
        <label>Date</label>
        <input type="date" id="sessionDate" class="form-control">
      </div>
      <div class="mb-3">
        <label>Time</label>
        <input type="time" id="sessionTime" class="form-control">
      </div>
      <button id="startSessionBtn" class="btn btn-primary w-100">Start Session</button>
      <button id="closeSessionBtn" class="btn btn-danger w-100 mt-2">Close Session</button>
      <div id="sessionMsg" class="mt-2"></div>
    </div>
  </div>

  <!-- Member Management -->
  <div class="card">
    <div class="card-body">
      <h5 class="card-title">Members List</h5>
      <ul id="memberList" class="list-group mb-3"></ul>
      <div class="mb-3">
        <input type="text" id="memberName" placeholder="Full Name" class="form-control mb-2">
        <input type="text" id="memberRole" placeholder="Role (optional)" class="form-control mb-2">
        <input type="text" id="memberPhone" placeholder="Phone" class="form-control mb-2">
        <button id="addMemberBtn" class="btn btn-success w-100">Add Member</button>
        <div id="addMsg" class="mt-2"></div>
      </div>
    </div>
  </div>
</main>

<footer>
  &copy; <span id="year"></span> Top Ministries International. All Rights Reserved. | 
  Contact: info@topministries.com
</footer>

<!-- Back to Top Button -->
<button id="backToTop" class="btn btn-primary" title="Back to Top">‚Üë</button>

<script>
  // Shrink header on scroll & Back to Top button
  const header = document.querySelector("header");
  const backToTop = document.getElementById("backToTop");
  window.addEventListener("scroll", () => {
    if(window.scrollY > 50) header.classList.add("shrink");
    else header.classList.remove("shrink");

    backToTop.style.display = window.scrollY > 200 ? "block" : "none";
  });
  backToTop.addEventListener("click", () => window.scrollTo({ top: 0, behavior: 'smooth' }));

  // --- Admin functionality ---
  let members = JSON.parse(localStorage.getItem("members")) || [];
  let regOpen = JSON.parse(localStorage.getItem("regOpen")) ?? true;

  const regStatus = document.getElementById("regStatus");
  const toggleRegBtn = document.getElementById("toggleRegBtn");
  const memberList = document.getElementById("memberList");
  const addMsg = document.getElementById("addMsg");

  const sessionDateInput = document.getElementById("sessionDate");
  const sessionTimeInput = document.getElementById("sessionTime");
  const startSessionBtn = document.getElementById("startSessionBtn");
  const closeSessionBtn = document.getElementById("closeSessionBtn");
  const sessionMsg = document.getElementById("sessionMsg");

  // --- Render Members ---
  function renderMembers() {
    memberList.innerHTML = "";
    if (!members.length) {
      memberList.innerHTML = `<li class="list-group-item">No members yet.</li>`;
      return;
    }
    members.forEach((m, index) => {
      const li = document.createElement("li");
      li.className = "list-group-item d-flex justify-content-between align-items-center flex-wrap";
      li.innerHTML = `${m.fullName} (${m.role || "Member"}) - ${m.phone} 
        <button class="btn btn-sm btn-danger mt-1 mt-sm-0">Delete</button>`;
      li.querySelector("button").onclick = () => {
        if(confirm(`Delete ${m.fullName}?`)) {
          members.splice(index, 1);
          localStorage.setItem("members", JSON.stringify(members));
          renderMembers();
        }
      };
      memberList.appendChild(li);
    });
  }

  // --- Render Registration Status ---
  function renderRegStatus() {
    regStatus.innerHTML = `<span class="badge ${regOpen ? "bg-success" : "bg-danger"}">
      ${regOpen ? "Open" : "Closed"}</span>`;
    toggleRegBtn.textContent = regOpen ? "Close Registration" : "Open Registration";
  }

  // --- Toggle Registration ---
  toggleRegBtn.onclick = () => {
    regOpen = !regOpen;
    localStorage.setItem("regOpen", JSON.stringify(regOpen));
    renderRegStatus();
  };

  // --- Add Member ---
  document.getElementById("addMemberBtn").onclick = () => {
    if (!regOpen) return alert("Registration is closed.");
    const name = document.getElementById("memberName").value.trim();
    const role = document.getElementById("memberRole").value.trim();
    const phone = document.getElementById("memberPhone").value.trim();
    if (!name || !phone) return alert("Name and phone are required.");
    if (!/^\d+$/.test(phone)) return alert("Phone must contain digits only.");
    if (members.some(m => m.phone === phone)) {
      addMsg.innerHTML = `<div class="alert alert-danger">‚ö†Ô∏è Phone number already exists.</div>`;
      setTimeout(() => addMsg.innerHTML="", 4000);
      return;
    }

    members.push({ id: Date.now().toString(), fullName: name, role, phone });
    localStorage.setItem("members", JSON.stringify(members));
    document.getElementById("memberName").value = "";
    document.getElementById("memberRole").value = "";
    document.getElementById("memberPhone").value = "";
    addMsg.innerHTML = `<div class="alert alert-success">‚úÖ Member added successfully.</div>`;
    setTimeout(() => addMsg.innerHTML="", 4000);
    renderMembers();
  };

  // --- Session Control ---
  startSessionBtn.onclick = () => {
    const date = sessionDateInput.value;
    const time = sessionTimeInput.value;
    if(!date || !time) return alert("Set both date and time");

    const currentSession = {
      sessionOpen: true,
      sessionDate: date,
      sessionTime: time,
      attendanceRecords: []
    };
    localStorage.setItem("currentSession", JSON.stringify(currentSession));
    localStorage.setItem("sessionOpen", JSON.stringify(true));
    localStorage.setItem("sessionDate", date);
    localStorage.setItem("sessionTime", time);

    sessionMsg.innerHTML = "<div class='text-success'>‚úÖ Session started!</div>";
  };

  closeSessionBtn.onclick = () => {
    let currentSession = JSON.parse(localStorage.getItem("currentSession")) || {};
    currentSession.sessionOpen = false;
    localStorage.setItem("currentSession", JSON.stringify(currentSession));
    localStorage.setItem("sessionOpen", JSON.stringify(false));
    sessionMsg.innerHTML = "<div class='text-warning'>‚ö†Ô∏è Session closed.</div>";
  };

  // --- Initialize ---
  renderMembers();
  renderRegStatus();
</script>

<script>
  // Automatically set the current year in footer
  document.getElementById("year").textContent = new Date().getFullYear();
</script>

</body>
</html>
