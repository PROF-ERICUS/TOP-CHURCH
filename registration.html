<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Member Registration</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  body { display: flex; flex-direction: column; min-height: 100vh; margin: 0; background-color: #f8f9fa; }

  header { background-color: #f71717; color: white; padding: 1rem; position: fixed; width: 100%; top: 0; z-index: 1000; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; transition: all 0.3s ease; }
  header.shrink { padding: 0.5rem 1rem; }
  header h3 { margin: 0; font-size: 1.5rem; transition: all 0.3s ease; }
  header.shrink h3 { font-size: 1.2rem; }
  nav a { margin: 0 0.5rem; }

  main { flex: 1 0 auto; padding: 120px 15px 15px; }
  #registrationCard { max-width: 600px; margin: auto; }
  footer { flex-shrink: 0; background-color: #343a40; color: white; padding: 1rem; text-align: center; }
  #otherRole { display: none; }
  #backToTop { position: fixed; bottom: 40px; right: 20px; display: none; z-index: 999; border-radius: 50%; width: 45px; height: 45px; font-size: 24px; line-height: 1; padding: 0; }

  @media(max-width: 576px){
    nav { margin-top: 0.5rem; width: 100%; text-align: center; }
    nav a { display: inline-block; margin: 0.25rem 0.25rem; }
  }

  /* Smooth fade for alerts */
  .fade-out { opacity: 1; transition: opacity 1s ease; }
  .fade-out.hidden { opacity: 0; }
</style>
</head>

<body>

<header>
  <h3>Top Ministries International</h3>
  <nav>
    <a href="index.html" class="btn btn-light btn-sm">Home</a>
    <a href="login.html" class="btn btn-light btn-sm">Login</a>
  </nav>
</header>

<main>
  <div id="closedMsg" class="alert alert-warning text-center mt-4 d-none">
    ðŸš« Registration is currently closed. Please check back later.
  </div>

  <div class="card" id="registrationCard">
    <div class="card-header bg-primary text-white text-center">Member Registration</div>
    <div class="card-body">
      <form id="registrationForm">
        <div class="mb-3">
          <label>Full Name</label>
          <input type="text" class="form-control" id="fullName" required>
        </div>
        <div class="mb-3">
          <label>Phone Number</label>
          <input type="text" class="form-control" id="phone" required>
        </div>
        <div class="mb-3">
          <label>Email (optional)</label>
          <input type="email" class="form-control" id="email">
        </div>
        <div class="mb-3">
          <label>Gender</label>
          <select class="form-select" id="gender" required>
            <option value="">Select...</option>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
          </select>
        </div>
        <div class="mb-3">
          <label>Role</label>
          <select class="form-select" id="role" required>
            <option value="">Select...</option>
            <option value="Zone 1">Zone 1</option>
            <option value="Zone 2">Zone 2</option>
            <option value="Zone 3">Zone 3</option>
            <option value="Zone 4">Zone 4</option>
            <option value="Zone 5">Zone 5</option>
            <option value="Pastor">Pastor</option>
            <option value="Others">Others</option>
          </select>
        </div>
        <div class="mb-3" id="otherRole">
          <label>Specify Role</label>
          <input type="text" class="form-control" id="otherRoleInput">
        </div>
        <button type="submit" class="btn btn-success w-100">Register</button>
      </form>
      <div class="alert alert-success mt-3 d-none" id="successMsg">
        âœ… Registration successful! Your details are saved.
      </div>
      <button id="gotoHome" class="btn btn-primary w-100 mt-3">Go to Homepage</button>
    </div>
  </div>
</main>

<footer>
  &copy; <span id="year"></span> Top Ministries International. All Rights Reserved. | 
  Contact: 0543300452
</footer>

<button id="backToTop" class="btn btn-primary" title="Back to Top">â†‘</button>

<script>
  // Shrink header on scroll & Back-to-Top button
  window.addEventListener("scroll", () => {
    const header = document.querySelector("header");
    const backToTop = document.getElementById("backToTop");
    if(window.scrollY > 50) header.classList.add("shrink");
    else header.classList.remove("shrink");
    backToTop.style.display = window.scrollY > 200 ? "block" : "none";
  });
  document.getElementById("backToTop").addEventListener("click", () => {
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  const form = document.getElementById("registrationForm");
  const successMsg = document.getElementById("successMsg");
  const roleSelect = document.getElementById("role");
  const otherRoleDiv = document.getElementById("otherRole");
  const otherRoleInput = document.getElementById("otherRoleInput");
  const registrationCard = document.getElementById("registrationCard");
  const closedMsg = document.getElementById("closedMsg");
  const gotoHome = document.getElementById("gotoHome");

  const registrationOpen = JSON.parse(localStorage.getItem("regOpen")) ?? true;
  if (!registrationOpen) {
    registrationCard.style.display = "none";
    closedMsg.classList.remove("d-none");
    gotoHome.style.display = "block";
  }

  roleSelect.addEventListener("change", () => {
    if (roleSelect.value === "Others") {
      otherRoleDiv.style.display = "block";
      otherRoleInput.required = true;
    } else {
      otherRoleDiv.style.display = "none";
      otherRoleInput.required = false;
      otherRoleInput.value = "";
    }
  });

  form.addEventListener("submit", e => {
    e.preventDefault();
    if(!registrationOpen) return alert("Registration is closed.");

    let members = JSON.parse(localStorage.getItem("members")) || [];
    const phoneVal = document.getElementById("phone").value.trim();
    if (members.some(m => m.phone === phoneVal)) {
      alert("Phone number already exists.");
      return;
    }

    let role = roleSelect.value;
    if (role === "Others") role = otherRoleInput.value.trim();

    const newMember = {
      id: Date.now().toString(),
      fullName: document.getElementById("fullName").value.trim(),
      phone: phoneVal,
      email: document.getElementById("email").value.trim(),
      gender: document.getElementById("gender").value,
      role: role
    };

    members.push(newMember);
    localStorage.setItem("members", JSON.stringify(members));

    // Show success alert with fade
    successMsg.classList.remove("d-none");
    successMsg.classList.add("fade-out");
    setTimeout(() => {
      successMsg.classList.add("hidden");
      setTimeout(() => {
        successMsg.classList.add("d-none");
        successMsg.classList.remove("fade-out", "hidden");
      }, 1000);
    }, 3000);

    form.reset();
    otherRoleDiv.style.display = "none";
    gotoHome.style.display = "block";
  });

  gotoHome.onclick = () => window.location.href = "index.html";

  document.getElementById("year").textContent = new Date().getFullYear();
</script>

</body>
</html>

